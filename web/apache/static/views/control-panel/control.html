<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Controles administrador</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <script>const apiUrl = "/api/peliculas"; // Ajustar según la URL de tu API

    // Función para insertar una película
    function insertMovie(event) {
      event.preventDefault(); // Evitar que el formulario recargue la página
    
      // Obtener los valores del formulario
      const nombre = document.getElementById("titulo").value;
      const sinopsis = document.getElementById("sinopsis").value;
      const categoria = document.getElementById("genero").value;
      const portada = document.getElementById("portada").files[0]; // Obtenemos el archivo de la portada
    
      // Crear un FormData para enviar los datos incluyendo el archivo
      const formData = new FormData();
      formData.append("nombre", nombre);
      formData.append("sinopsis", sinopsis);
      formData.append("categoria", categoria);
      formData.append("portada", portada);
    
      // Configurar la solicitud para enviar los datos
      const requestOptions = {
        method: "POST",
        body: formData,
      };
    
      // Enviar los datos al servidor
      fetch(apiUrl, requestOptions)
        .then((response) => response.json())
        .then((result) => {
          if (result.status === "OK") {
            alert("Película guardada con éxito");
            cerrarFormulario();
            agregarFila(nombre, categoria, sinopsis, URL.createObjectURL(portada)); // Mostrar la película en la tabla
          } else {
            alert("La película no se ha guardado");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("Se ha producido un error");
        });
    }
    
    // Función para agregar una fila a la tabla
    function agregarFila(nombre, categoria, sinopsis, portadaUrl) {
      const movieList = document.getElementById("movie-list");
      const row = document.createElement("tr");
    
      row.innerHTML = `
        <td>${nombre}</td>
        <td>${categoria}</td>
        <td>${sinopsis}</td>
        <td><img src="${portadaUrl}" alt="Portada" width="50" /></td>
        <td>
          <button onclick="deleteMovie(this)">Eliminar</button>
        </td>
      `;
    
      movieList.appendChild(row);
    }
    
    // Función para eliminar una película de la tabla
    function deleteMovie(button) {
      const row = button.closest("tr"); // Encuentra la fila más cercana al botón
      const movieId = row.dataset.id; // Asumir que cada fila tiene un 'data-id' con el ID de la película
    
      // Eliminar película desde la API
      fetch(`/api/peliculas/${movieId}`, { method: "DELETE" })
        .then((response) => response.json())
        .then((result) => {
          if (result.status === "OK") {
            row.remove(); // Eliminar la fila de la tabla
          } else {
            alert("La película no se ha eliminado");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("Se ha producido un error al eliminar la película");
        });
    }
    
    // Función para abrir el formulario modal
    function abrirFormulario() {
      document.getElementById("modal-form").style.display = "flex";
    }
    
    // Función para cerrar el formulario modal
    function cerrarFormulario() {
      document.getElementById("modal-form").style.display = "none";
    }</script>
  <body>
    <header class="header">
      <a href="../home/home.html" class="header-logo">Popfilm</a>
      <nav class="header-nav">
        <a href="../home/home.html">Inicio</a>
        <a href="control.html">Modificar</a>
      </nav>
      <div class="account-actions">
        <a href="register/register.html">
          <img src="../../assets/account_icon.svg" alt="Account Circle" />
        </a>
      </div>
    </header>

    <div class="container">
      <div class="add-movie-button">
        <button class="button" onclick="abrirFormulario()">
          Agregar Película
        </button>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Título</th>
              <th>Categoria</th>
              <th>Sinopsis</th>
              <th>Portada</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="movie-list">
            <!-- Las películas se cargarán aquí dinámicamente -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal-form" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="cerrarFormulario()">×</span>
        <h2>Agregar Película</h2>
        <form id="movie-form" onsubmit="insertMovie(event)">
          <label for="titulo">Título:</label>
          <input type="text" id="titulo" name="titulo" required />

          <label for="genero">Categoria:</label>
          <input type="text" id="genero" name="genero" required />

          <label for="sinopsis">Sinopsis:</label>
          <input type="text" id="sinopsis" name="sinopsis" required />

          <label for="portada">Portada:</label>
          <input type="file" id="portada" name="portada" required />

          <button type="submit" class="button">Guardar</button>
        </form>
      </div>
    </div>

    
  </body>
</html>
